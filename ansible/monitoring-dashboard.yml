#
# Copyright StackHPC, 2017
#
---
- name: Configure dashboards
  hosts: cluster_login
  run_once: true
  roles:
  - role: stackhpc.grafana-conf
    grafana_conf_organisation: "{{ project_name }}"
    grafana_conf_grafana_admin_user: "{{ grafana_admin_username }}"
    grafana_conf_grafana_admin_pass: "{{ grafana_admin_password }}"
    grafana_conf_grafana_dashboard_repo:
      repo: "https://github.com/stackhpc/grafana-reference-dashboards.git"
      checkout_path: "{{ ansible_user_dir }}/grafana-dashboards"
      version: "master"
      relative_path: "/monasca/tenant"
    grafana_conf_grafana_url: "http://{{ controller_vip }}:3000"
    grafana_conf_grafana_datasources:
      # TODO: Change to VIP when these are behind HAProxy
      monasca_api:
        port: 8082
        host: "{{ alaska_monitoring_server }}"
      monasca_log_api:
        port: 5607
        host: "{{ alaska_monitoring_server }}"
